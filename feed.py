#!/usr/bin/env python

from twisted.web.server import Site
from twisted.web.resource import Resource
from twisted.internet import reactor
import json
from calendar import calendar

class YearPage(Resource):
    def __init__(self, year):
        Resource.__init__(self)
        self.year = year

    def render_GET(self, request):
        return "<html><body><pre>%s</pre></body></html>" % (calendar(self.year),)

class Router(Resource):
    def __init__(self, name):
        Resource.__init__(self)
        self.name = name
        
    def render_GET(self, request):
        print request.uri
        print "name: %s" % self.name
        request.setHeader("content-type", "text/plain")
        request.setHeader("Access-Control-Allow-Origin", "*")

        if self.name == "config":
            response = {"supports_search":True,
                        "supports_group_request":False,
                        "supported_resolutions":["D","W","M"],
                        "supports_marks":False
                       }
            string = json.dumps(response)
            return string
        elif self.name == "symbols":
            response = {"name":"AA",
                        "exchange-traded":"NYSE",
                        "exchange-listed":"NYSE",
                        "timesone":"America/New_York",
                        "minmov":1,
                        "minmov2":0,
                        "pricescale":10,
                        "pointvalue":1,
                        "session":"0930-1630",
                        "has_intraday":False,
                        "has_no_volume":False,
                        "ticker":"AA",
                        "description":"Alcoa Inc.",
                        "type":"stock",
                        "supported_resolutions":["D"]
                       }
            string = json.dumps(response)
            return string
            
        elif self.name == "history":
            response = {"t":[1401667200,1401753600,1401840000,1401926400,1402012800,1402272000,1402358400,1402444800,1402531200,1402617600,1402876800,1402963200,1403049600,1403136000,1403222400,1403481600,1403568000,1403654400,1403740800,1403827200,1404086400,1404172800,1404259200,1404345600,1404691200,1404777600,1404864000,1404950400,1405036800,1405296000,1405382400,1405468800,1405555200,1405641600,1405900800,1405987200,1406073600,1406160000,1406246400,1406505600,1406592000,1406678400,1406764800,1406851200,1407110400,1407196800,1407283200,1407369600,1407456000,1407715200,1407801600,1407888000,1407974400,1408060800,1408320000,1408406400,1408492800,1408579200,1408665600,1408924800,1409011200,1409097600,1409184000,1409270400,1409616000,1409702400,1409788800,1409875200,1410134400,1410220800,1410307200,1410393600,1410480000,1410739200,1410825600,1410912000,1410998400,1411084800,1411344000,1411430400,1411516800,1411603200,1411689600,1411948800,1412035200,1412121600,1412208000,1412294400,1412553600,1412640000,1412726400,1412812800,1412899200,1413158400,1413244800,1413331200,1413417600,1413504000,1413763200,1413849600,1413936000,1414022400,1414108800,1414368000,1414454400,1414540800,1414627200,1414713600,1414972800,1415059200,1415145600,1415232000,1415318400,1415577600,1415664000,1415750400,1415836800,1415923200,1416182400,1416268800,1416355200,1416441600,1416528000,1416787200,1416873600,1416960000,1417132800,1417392000,1417478400,1417564800,1417651200,1417737600,1417996800,1418083200,1418169600,1418256000,1418342400,1418601600,1418688000,1418774400,1418860800,1418947200,1419206400,1419292800,1419379200,1419552000,1419811200,1419897600,1419984000,1420156800,1420416000,1420502400,1420588800,1420675200,1420761600,1421020800,1421107200,1421193600,1421280000,1421366400,1421712000,1421798400,1421884800,1421971200,1422230400,1422316800,1422403200,1422489600,1422576000,1422835200,1422921600,1423008000,1423094400,1423180800,1423440000,1423526400,1423612800,1423699200,1423785600,1424131200,1424217600,1424304000,1424390400,1424649600,1424736000,1424822400,1424908800,1424995200,1425254400,1425340800,1425427200,1425513600,1425600000,1425859200,1425945600,1426032000,1426118400,1426204800,1426464000,1426550400,1426636800,1426723200,1426809600,1427068800,1427155200,1427241600,1427328000,1427414400,1427673600,1427760000,1427846400,1427932800,1428278400,1428364800,1428451200,1428537600,1428624000,1428883200,1428969600,1429056000,1429142400,1429228800,1429488000,1429574400,1429660800,1429747200,1429833600,1430092800,1430179200,1430265600,1430352000,1430438400,1430697600,1430784000,1430870400,1430956800,1431043200,1431302400,1431388800,1431475200,1431561600,1431648000,1431907200,1431993600,1432080000,1432166400,1432252800,1432598400,1432684800,1432771200,1432857600,1433116800,1433203200,1433289600,1433376000,1433462400],
                        "c":[13.83,13.65,13.82,14,14.35,14.35,14.23,14.18,14.01,14.52,14.35,14.48,14.64,14.46,14.62,14.77,14.47,14.55,14.94,14.93,14.89,14.8,14.85,14.98,14.74,14.85,15.69,15.62,15.97,16.11,16.12,16.6,16.33,16.49,16.62,17.09,17.05,17,16.56,17.01,16.91,16.72,16.39,16.44,16.71,16.44,16.44,16,16.1,16.19,16.19,16.24,16.23,16.11,16.32,16.43,16.5,16.35,16.45,16.48,16.59,16.71,16.57,16.61,16.67,16.93,17.1,17.28,17.01,17.11,17.2,16.9,16.72,16.39,16.16,16.28,16.2,16.21,15.83,15.7,15.9,15.63,16.19,15.93,16.09,15.7,15.36,15.6,15.99,15.95,16.07,15.39,14.71,14.49,14.29,14.5,14.6,15.62,15.69,16.35,16.12,16.24,16.55,16.38,16.6,16.27,16.22,16.76,16.93,16.56,16.26,16.37,16.33,16.32,16.45,16.88,16.74,16.94,16.83,17.16,16.69,17.12,17.45,17.22,17.37,17.6,17.29,17.14,17.3,17.21,17.24,16.95,16.29,16.04,15.63,15.16,14.87,14.93,14.43,15.05,15.78,15.94,15.74,15.73,15.77,15.82,15.82,15.85,15.79,15.88,14.96,15.07,15.46,15.9,16.11,16.17,15.8,14.95,14.97,15.28,15.55,15.92,16.04,15.76,16.08,15.92,15.8,15.98,15.65,16.07,16.61,16.42,17.07,16.57,15.65,15.91,15.46,15.65,15.81,15.75,15.85,16,15.79,15.51,15.74,15,15.11,14.79,14.95,15.18,14.59,14.38,14.48,13.7,13.5,13.59,13.8,13.57,13.29,13.06,13.28,12.96,12.97,13,13.09,12.97,12.88,12.7,12.96,12.92,13,13.14,13.36,13.43,13.67,13.21,13.15,13.29,13.37,13.34,13.45,13.46,13.58,13.52,13.57,13.19,13.22,13.45,13.48,13.6,13.42,14.15,14.01,13.82,13.7,13.71,13.82,13.65,13.55,13.63,13.64,13.54,13.4,13.08,13.07,13,12.94,12.76,12.79,12.68,12.5,12.42,12.62,12.61,12.5,12.42],
                        "o":[13.77,13.74,13.61,13.8,13.95,14.34,14.26,14.18,14.11,14.09,14.49,14.35,14.41,14.71,14.53,14.69,14.77,14.42,15.11,14.92,14.89,14.93,14.85,14.89,14.99,14.78,15.24,15.58,15.64,16.17,16.12,16.16,16.46,16.33,16.39,16.69,17.22,17.06,16.94,16.6,17.09,17,16.61,16.26,16.58,16.63,16.25,16.46,15.72,16.3,16.22,16.22,16.19,16.27,16.2,16.37,16.38,16.52,16.3,16.48,16.47,16.61,16.62,16.63,16.64,16.68,16.98,17.11,17.28,17.11,17.05,17.27,16.98,16.72,16.07,16.1,16.33,16.28,16.17,15.65,15.77,15.88,15.7,15.93,16.23,16.13,15.72,15.46,15.76,15.94,15.99,16.35,15.23,14.89,14.65,14,14.07,14.86,15.54,15.85,16.41,16.35,16.33,16.56,16.5,16.58,16.17,16.43,16.78,16.85,16.68,16.37,16.47,16.27,16.29,16.42,16.91,16.74,16.91,16.82,17.13,16.57,17.52,17.5,17.3,17.46,17.58,17.4,17.12,17.31,17.33,17.36,16.9,15.92,15.98,15.63,15.02,15.06,15.04,14.58,15.48,15.78,15.97,15.8,15.77,15.88,15.84,15.73,15.85,15.87,15.64,15.02,15.28,15.66,16.03,16.4,16.47,15.46,15.16,14.96,15.36,15.55,16.03,15.8,15.71,15.72,16.03,15.92,15.85,15.82,16.35,16.48,16.44,17,16.1,15.72,15.74,15.71,15.8,15.84,15.73,15.78,15.93,15.63,15.57,15.66,15.09,15.1,14.79,14.88,14.74,14.43,14.31,13.93,13.63,13.58,13.73,13.73,13.64,13.15,13.01,13.16,13.02,12.94,12.9,13.07,12.86,12.83,12.85,12.82,12.91,12.92,13.27,13.49,13.61,13.42,13.24,13.14,13.37,13.4,13.63,13.39,13.53,13.67,13.54,13.3,13.27,13.28,13.54,13.35,13.57,13.5,14.13,14.13,13.94,13.6,13.84,13.86,13.58,13.59,13.76,13.64,13.52,13.34,13.13,13.1,12.99,12.91,12.74,12.69,12.62,12.54,12.42,12.63,12.53,12.45],
                        "h":[13.87,13.77,13.85,14.13,14.35,14.58,14.33,14.29,14.19,14.56,14.52,14.52,14.67,14.71,14.65,14.79,14.79,14.6,15.18,15,14.9,15,14.89,15.07,15.05,14.89,15.76,15.97,15.98,16.25,16.19,16.71,16.57,16.58,16.68,17.16,17.22,17.18,16.94,17.03,17.14,17.06,16.63,16.61,16.74,16.64,16.6,16.54,16.15,16.41,16.41,16.29,16.27,16.32,16.36,16.47,16.69,16.52,16.53,16.57,16.71,16.72,16.68,16.69,16.72,17,17.36,17.29,17.3,17.28,17.2,17.29,16.98,16.75,16.49,16.35,16.42,16.34,16.17,15.98,15.95,15.94,16.23,16.09,16.34,16.14,15.74,15.78,16.05,16.22,16.07,16.43,15.35,15.26,14.73,14.57,14.65,15.62,15.71,16.43,16.52,16.47,16.57,16.57,16.65,16.7,16.36,16.76,17.03,16.87,16.69,16.42,16.49,16.46,16.48,16.92,16.99,16.98,16.95,17.21,17.13,17.18,17.75,17.61,17.66,17.6,17.59,17.42,17.37,17.41,17.45,17.39,16.96,16.18,16.17,15.73,15.29,15.29,15.21,15.07,15.79,16.04,15.99,15.98,15.84,15.93,15.96,15.93,16.03,15.98,15.65,15.37,15.57,16.05,16.15,16.43,16.53,15.48,15.23,15.28,15.58,16.03,16.07,15.95,16.11,16.05,16.18,16,16.05,16.1,16.62,16.65,17.1,17,16.1,15.92,15.74,15.79,15.92,15.86,15.88,16.02,16.07,15.64,15.78,15.7,15.19,15.15,15.02,15.32,14.78,14.49,14.56,13.99,13.72,13.63,13.88,13.78,13.67,13.24,13.43,13.17,13.09,13.2,13.11,13.27,13.01,12.85,13.01,12.99,13.1,13.28,13.44,13.61,13.8,13.45,13.27,13.38,13.44,13.43,13.7,13.52,13.73,13.67,13.58,13.42,13.29,13.63,13.74,13.63,13.57,14.29,14.25,14.16,13.97,13.78,13.88,13.89,13.66,13.87,13.85,13.65,13.53,13.37,13.16,13.11,13.05,12.91,12.85,12.73,12.65,12.55,12.8,12.8,12.65,12.49],
                        "l":[13.54,13.54,13.54,13.73,13.94,14.26,14.11,14.11,13.93,14.07,14.32,14.28,14.29,14.42,14.46,14.65,14.44,14.35,14.74,14.75,14.68,14.75,14.8,14.83,14.7,14.56,15.16,15.42,15.62,15.91,15.93,16.12,16.27,16.32,16.36,16.69,17,16.96,16.53,16.6,16.9,16.63,16.12,16.2,16.45,16.37,16.25,15.87,15.6,16.15,16.15,16.13,16.16,16.02,16.15,16.27,16.36,16.26,16.24,16.37,16.43,16.51,16.52,16.47,16.56,16.67,16.91,17.01,16.96,17.03,16.95,16.83,16.55,16.22,16.05,16.09,16.14,16.16,15.73,15.56,15.65,15.53,15.65,15.75,15.98,15.63,14.89,15.39,15.68,15.81,15.49,15.17,14.62,14.45,14.06,13.71,14.01,14.82,15.44,15.83,16.05,16.12,16.22,16.31,16.41,16.05,15.83,16.24,16.65,16.43,16.17,16.15,16.24,16.16,16.2,16.34,16.67,16.61,16.75,16.82,16.62,16.53,17.33,17.16,17.27,17.25,17.16,17,17.06,17.16,17.15,16.91,16.23,15.75,15.58,15.11,14.85,14.9,14.41,14.49,15.36,15.73,15.48,15.67,15.56,15.78,15.73,15.63,15.77,15.67,14.89,14.85,15.21,15.55,15.75,15.93,15.7,14.54,14.9,14.96,15.06,15.43,15.71,15.54,15.56,15.72,15.76,15.61,15.62,15.76,16.16,16.36,16.41,16.47,15.55,15.55,15.25,15.54,15.6,15.64,15.62,15.66,15.7,15.38,15.53,14.85,14.94,14.7,14.74,14.88,14.15,14.22,14.23,13.34,13.44,13.5,13.62,13.42,13.18,13.01,12.96,12.78,12.9,12.9,12.75,12.96,12.84,12.65,12.78,12.8,12.86,12.79,13.21,13.42,13.54,12.96,13,13.09,13.3,13.28,13.44,13.3,13.46,13.44,13.43,13.1,13.17,13.27,13.45,13.33,13.32,13.48,14.01,13.8,13.65,13.46,13.65,13.62,13.52,13.59,13.63,13.51,13.3,13.03,13.02,12.99,12.93,12.66,12.68,12.57,12.44,12.29,12.41,12.6,12.47,12.35],
                        "v":[14180800,10747200,7901100,12809900,15896900,11403100,8035100,8192000,10226200,14416300,7463200,7390200,11264300,12790700,14830600,7655500,9557700,8180200,28895100,17907800,12960200,10399000,10395200,7816500,16482400,27337500,54283500,28419500,15560800,24262400,19594400,23618600,22347800,12609600,18571700,31546600,21148700,20955100,21327200,18009500,16859400,13685300,25988400,14584800,14969100,17046900,11504400,19259900,13870100,9908100,15226900,9404200,5977800,11303000,11795900,13166300,13094800,8555600,7595000,7284900,7312500,7601600,6675600,9158800,10752000,10870000,15614600,9601800,11202200,14906300,14352900,16995400,20244200,20853900,43666500,36789100,17202300,19978100,22568300,16477000,12841700,19279400,19717000,17355700,21787000,21735700,25180500,20305000,23779300,26113500,34309000,55796900,39728300,25045400,36096200,36785500,26493500,35761400,15217700,23004300,27457700,17226500,12853900,15444000,12307200,31173500,17857100,18621400,15965400,13214200,18204400,14223200,13507500,10721300,6971300,15861900,12458100,8832300,7663200,14723500,15860300,13583500,20683800,12943900,14535000,9140400,8815900,13324600,13498600,16259400,13714700,16320500,21994200,22649300,18394900,20294600,19144700,25730200,29374200,26490100,29453400,20169800,17146800,10533100,4944200,6355200,7087800,9262100,8842400,10430000,21690600,19377000,15950500,19670600,16732300,30419200,37789700,54936800,26455000,21762800,25950000,20600900,15373600,18659500,12392500,15613400,16117400,14725600,16799800,14700900,19425200,15182100,24181800,20896700,31109900,25138100,27608700,19335600,16075700,12986800,12473300,16622800,14179600,13982700,9960200,34350100,18776600,20801500,19367400,16406700,40343200,17156700,19998900,78393300,33728300,23194900,21593900,16909200,29888800,29329300,55663800,34460400,38762300,25299300,32286200,26136600,30461800,16993500,16128700,23009300,38358900,23429500,22792000,22890900,42623700,58344600,36451900,22927100,21941000,34605200,43443800,23773200,17697200,17597800,13775300,46055300,20461900,28600700,14950900,14886800,25157300,50363600,17522800,15667300,13867700,12844900,12532600,10942100,12251000,15293900,11135600,9288000,15699400,30799900,16263200,16853900,13105800,21992500,16376700,18040400,22056900,14012200,18954400,14727700,14010800,17207000],
                        "s":"ok"
                        }
            string = json.dumps(response)
            return string
class DataFeed(Resource):
    def getChild(self, name, request):
        return Router(name)
        
root = DataFeed()
factory = Site(root)
reactor.listenTCP(8080, factory)
reactor.run()


